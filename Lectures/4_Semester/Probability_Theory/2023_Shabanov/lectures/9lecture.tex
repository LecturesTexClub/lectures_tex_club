\subsection{Усиленная теорема}

\begin{note}
	Самая сильная теорема, которую мы хотим доказать --- это как раз ЗБЧ без требования не четвертый момент. Здесь мы тратим большую часть времени на развитие теории для доказательства.
\end{note}

\begin{definition}
	Последовательность случайных величин $\{\xi_n\}_{n = 1}^\infty$ \textit{фундаментальна с вероятностью 1}, если
	\[
		P\{\omega \in \Omega \colon \{\xi_n(\omega)\}_{n = 1}^\infty \text{ фундаментальна}\} = 1
	\]
\end{definition}

\begin{proposition}
	Последовательность случайных величин $\{\xi_n\}_{n = 1}^\infty$ сходится почти наверное по мере $P$ тогда и только тогда, когда она фундаментальна с вероятностью 1.
\end{proposition}

\begin{proof}~
	\begin{itemize}
		\item[$\Ra$] Пусть $\xi_n \to^{P\text{ п.н.}} \xi$, тогда
		\[
			P(\{\xi_n\}_{n = 1}^\infty \text{ фундаментальна}) \ge P(\xi_n \to \xi) = 1
		\]
		
		\item [$\La$] Обозначим $A = \{\{\xi_n\}_{n = 1}^\infty \text{ фундаментальна}\}$. Тогда $\forall \omega \in A$ последовательность имеет некоторый предел, который мы положим за $\xi(\omega)$. Если $\omega \notin A$, то $\xi(\omega) := 0$. В результате становится верным равенство:
		\[
			\xi(\omega) = \lim_{n \to \infty} (\xi_n(\omega) \cdot \chi_A(\omega))
		\]
		Стало быть, $\xi$ является случайной величиной как предел последовательности случайных величин. Ну и остаётся увидеть соотношение:
		\[
			P(\xi_n \to \xi) \ge P(A) = 1
		\]
	\end{itemize}
\end{proof}

\begin{theorem} (Критерий фундаментальности с вероятностью 1)
	Последовательность $\{\xi_n\}_{n = 1}^\infty$ фундаментальна с вероятностью 1 тогда и только тогда, когда верно утверждение:
	\[
		\forall \eps > 0\ \ P(\sup_{k \ge n} |\xi_k - \xi_n| > \eps) \xrightarrow[n \to \infty]{} 0
	\]
\end{theorem}

\begin{proof}
	\textcolor{red}{Возможно без доказательства, лектор скипнул}
\end{proof}

\begin{theorem} (Неравенство Колмогорова)
	Пусть $\{\xi_k\}_{k = 1}^n$ --- независимые случайные величины, причём $\E\xi_k = 0$ и $\E\xi_k^2 < +\infty$. Обозначим $S_k = \xi_1 + \ldots + \xi_k$. Тогда верно утверждение:
	\[
		\forall \eps > 0\ \ P(\max_{1 \le k \le n} |S_k| \ge \eps) \le \frac{\E S_n^2}{\eps^2}
	\]
\end{theorem}

\begin{note}
	Модуль из неравенства можно записать как $|S_k - \E S_k|$, что делает это неравенство ещё более схожим с неравенством Чебышёва. Однако, здесь результат намного более сильный --- мы сразу оценили все $S_k$
\end{note}

\begin{proof}
	Проделаем вещи, очень схожие с неравенством Маркова, а именно мы получим нужный результат через расписывание $\E S_n^2$. Зафиксируем $\eps > 0$ и обозначим $A = \{\max_{1 \le k \le n} |S_k| \ge \eps\}$ --- ровно то событие, которое оцениваем в теореме. Немного порассуждаем: если максимум стал не меньше $\eps$, то был первый момент, когда это произошло (если бы мы рассматривали конкретные результаты от меньшего к большему индексу). Введём соответствующие события $A_k$, которые тогда в совокупности дадут $A$:
	\[
		A_k = \{|S_k| \ge \eps \wedge \forall 1 \le i < k\ \ |S_i| < \eps\}\Ra A = \bscup_{k = 1}^n A_k
	\]
	Итак, оценим матожидание квадрата суммы:
	\[
		\E S_n^2 \ge \E (S_n^2 \cdot \chi_A) = \sum_{k = 1}^n \E (S_n^2 \cdot \chi_{A_k})
	\]
	Отдельно распишем каждое слагаемое:
	\begin{multline*}
		\E (S_n^2 \chi_{A_k}) = \E\big((S_k + \xi_{k + 1} \plusdots \xi_n)^2 \chi_{A_k}\big) =
		\\
		\E (S_k^2\chi_{A_k}) + \E\big((\xi_{k + 1} + \ldots + \xi_n)^2\chi_{A_k}\big) + 2\E(S_k\chi_{A_k})(\xi_{k + 1} \plusdots \xi_n)
	\end{multline*}
	Нас в конечном итоге волнует только первое слагаемое. Второе мы просто оценим нулём, а последнее, неожиданно, именно равно нулю. Действительно, если пристально посмотреть, то первая скобка зависит от первых $k$ независимых случайных величин, а вторая от оставшихся из $n$. По теореме о независимости композиций, эти случайные величины независимы, а матожидание от второй будет нулём в силу условия. Таким образом, $\E(S_n^2\chi_{A_k}) \ge \E(S_k^2\chi_{A_k})$. Осталось собрать всё воедино (и не забыть, что же нам даёт событие $A_k$ про величину $S_k$):
	\[
		\E S_n^2 \ge \sum_{k = 1}^n \E(S_k^2\chi_{A_k}) \ge \sum_{k = 1}^n \eps^2\E\chi_{A_k} = \eps^2 \sum_{i = 1}^n P(A_k) = \eps^2 P(A)
	\]
\end{proof}

\begin{theorem} (Колмогорова-Хинчина, достаточно условие сходимости ряда почти наверное)
	Пусть $\{\xi_n\}_{n = 1}^\infty$ --- случайные величины, на которые наложены следующие ограничения:
	\begin{enumerate}
		\item $\{\xi_n\}_{n = 1}^\infty$ --- попарно независимы
		
		\item $\forall n \in \N\ \ \E\xi_n = 0,\ D\xi_n < +\infty$
		
		\item $\sum_{n = 1}^\infty D\xi_n < +\infty$
	\end{enumerate}
	Тогда ряд $\sum_{n = 1}^\infty \xi_n$ сходится $P$-почти наверное.
\end{theorem}

\begin{proof}
	Как и полагается проверке любого ряда на сходимость, нам нужно ввести префиксные суммы $S_n = \xi_1 \plusdots \xi_n$ (ведь сходимость ряда почти наверное означает сходимость почти наверное этих сумм). Эта последовательность сходится почти наверное тогда и только тогда, когда она фундаментальна с вероятностью 1, а это в свою очередь равносильно выполнению критерия:
	\[
		\forall \eps > 0\ \ P(\sup_{k \ge n} |S_k - S_n| > \eps) \xrightarrow[n \to \infty]{} 0
	\]
	Зафиксируем $\eps > 0$ и распишем эту вероятность (подгоним под неравенство Колмогорова):
	\[
		P(\sup_{k \ge n} |S_k - S_n| > \eps) = P\ps{\bigcup_{k = n}^\infty \{|S_k - S_n| > \eps\}} = \lim_{N \to \infty} P\ps{\bigcup_{k = n}^N \{|S_k - S_n| > \eps\}}
	\]
	Последний переход работает в силу непрерывности вероятностной меры. В конечное объединение попадают все $\omega \in \Omega$, для которых хотя бы при каком-то $k$ выполнится неравенство. Это эквивалентно тому, что неравенство верно для максимума по всем разностям (и сразу после применяем неравенство Колмогорова):
	\begin{multline*}
		P(\sup_{k \ge n} |S_k - S_n| > \eps) = \lim_{N \to \infty} P(\max_{0 \le k \le N - n} |S_{n + k} - S_n| > \eps) \le
		\\
		\lim_{N \to \infty} \frac{\E |S_N - S_n|^2}{\eps^2} = \lim_{N \to \infty} \frac{D(\xi_{n + 1} + \ldots + \xi_N)}{\eps^2} = \lim_{N \to \infty} \frac{\sum_{k = n + 1}^N D(\xi_k)}{\eps^2} \le
		\\
		\frac{1}{\eps^2} \sum_{k = n + 1}^\infty D(\xi_k) \xrightarrow[n \to \infty]{} 0
	\end{multline*}
	Пояснение: мы перешли от матожиданий к дисперсии, коль скоро матожидание всех величин ноль по условию. В финальной оценке получили стремление к нулю, коль скоро по условию ряд сходится, а мы оценили нужную вероятность остатком ряда.
\end{proof}

\begin{definition}
	Пусть $\{A_n\}_{n = 1}^\infty \subseteq \F$ --- последовательность событий. Тогда событием $\{\text{хотя бы одно из событий $A_n$ произошло бесконечное число раз}\} =: \{A_n \text{ б.ч.}\}$ мы назовём соответствующее событие, которое выразим так:
	\[
		\{A_n \text{ б.ч.}\} = \bigcap_{n = 1}^\infty \bigcup_{m = n}^\infty A_m
	\]
\end{definition}

\begin{lemma} (Бореля-Кантелли)
	Пусть $\{A_n\}_{n = 1}^\infty \subseteq \F$ --- последовательность событий. Тогда верна одна из двух вещей:
	\begin{itemize}
		\item Если $\sum_{n = 1}^\infty P(A_n) < \infty$, то $P(A_n \text{ б.ч.}) = 0$
		
		\item Если $\sum_{n = 1}^\infty P(A_n) = \infty$ и события $\{A_n\}_{n = 1}^\infty$ независимы в совокупности, то \\ $P(A_n \text{ б.ч.}) = 1$
	\end{itemize}
\end{lemma}

\begin{proof}~
	\begin{itemize}
		\item В первом случае оценку получить очень просто, если расписать вероятность бесконечного числа исходов:
		\[
			P(A_n \text{ б.ч.}) = P\ps{\bigcap_{n = 1}^\infty \bigcup_{m = n}^\infty A_m} = \lim_{n \to \infty} P\ps{\bigcup_{m = n}^\infty A_m} \le \lim_{n \to \infty} \sum_{m = n}^\infty P(A_m) = 0
		\]
		Коль скоро ряд сходится по условию, то предел его остатка точно ноль.
		
		\item Продолжим работать с вероятностью бесконечного числа исходов, но теперь будем искать оценку снизу (за счёт применения дополнения события в некотором месте):
		\[
			P(A_n \text{ б.ч.}) = \lim_{n \to \infty} P\ps{\bigcup_{m = n}^\infty A_m} = 1 - \lim_{n \to \infty} P\ps{\bigcap_{m = n}^\infty \ol{A}_m} = 1 - \lim_{n \to \infty} \lim_{N \to \infty} P\ps{\bigcap_{m = n}^N \ol{A}_m}
		\]
		Второй предел появился для того, чтобы мы могли использовать независимость событий (ибо это работает только на конечном числе). Теперь надо показать, что этот двойной предел --- ноль (в силу предположения леммы). Далее мы просто сведём внутренний предел к сумме расходящегося ряда за счёт поднятия вероятности в экспоненту:
		\begin{multline*}
			\lim_{N \to \infty} P\ps{\bigcap_{m = n}^N \ol{A}_m} = \lim_{N \to \infty} \prod_{m = n}^N (1 - P(A_m)) \le
			\\
			\lim_{N \to \infty} \prod_{m = n}^N e^{-P(A_m)} = \lim_{N \to \infty} \exp\ps{-\sum_{m = n}^N P(A_m)} = \exp\ps{-\sum_{m = n}^\infty P(A_m)} = 0
		\end{multline*}
	\end{itemize}
\end{proof}

\begin{lemma} (Теплица)
	Пусть $\sum_{n = 1}^\infty a_n$ --- расходящийся ряд с положительными коэффициентами, $x_n \to x$ --- произвольная сходящаяся последовательность, тогда, положив $b_n = \sum_{j = 1}^n a_j$:
	\[
		\frac{1}{b_n} \sum_{j = 1}^n a_jx_j \to x
	\]
\end{lemma}

\begin{proof}
	На самом деле, доказательство на поверхности. Зафиксируем $\eps > 0$ и распишем разность, которая возникает в определении предела по Коши:
	\[
		\md{\frac{1}{b_n} \sum_{j = 1}^n a_jx_j - x} = \frac{1}{b_n} \md{\sum_{j = 1}^n a_j(x_j - x)} \le \frac{1}{b_n} \sum_{j = 1}^n a_j|x_j - x|
	\]
	К сожалению, просто ограничить модуль не выйдет, ибо сумма идёт от самого первого слагаемого. Но ничего страшного, значит мы разобьём сумму на две:
	\begin{align*}
		&{\exists n_0 \in \N \such \forall j > n_0\ \ |x_j - x| < \frac{\eps}{2}}
		\\
		&{\exists n_1 \in \N \such n_1 > n_0 \wedge \frac{1}{b_{n_1}} \sum_{j = 1}^{n_0} a_j|x_j - x|} < \frac{\eps}{2}
	\end{align*}
	Теперь посмотрим на любое $n > n_1$. Тогда:
	\[
		\frac{1}{b_n} \sum_{j = 1}^n a_j|x_j - x| \le \frac{1}{b_{n_1}}\sum_{j = 1}^{n_0} a_j|x_j - x| + \frac{1}{b_n} \sum_{j = n_0 + 1}^n a_j|x_j - x| < \frac{\eps}{2} + \frac{1}{b_n}\ps{\sum_{j = n_0 + 1}^n a_j} \frac{\eps}{2} < \eps
	\]
\end{proof}

\begin{lemma} (Кронекера)
	Пусть даны последовательности $\{b_n\}_{n = 1}^\infty$ и $\{x_n\}_{n = 1}^\infty$ со следующими ограничениями:
	\begin{enumerate}
		\item $0 < b_n \sua \infty$
		
		\item $\sum_{n = 1}^\infty x_n$ --- сходящийся ряд
	\end{enumerate}
	Тогда $(1 / b_n)\sum_{j = 1}^n b_jx_j$ тоже сходящийся ряд.
\end{lemma}

\begin{proof}
	Обозначим $S_n = x_1 \plusdots x_n$. Применим преобразование Абеля к сумме в исследуемом ряду:
	\[
		\frac{1}{b_n}\sum_{j = 1}^n b_jx_j = \frac{1}{b_n}\ps{b_nS_n - b_0S_0 - \sum_{j = 1}^{n - 1} S_j(b_{j + 1} - b_j)} = S_n - \frac{1}{b_n}\sum_{j = 1}^{n - 1} S_j(b_{j + 1} - b_j)
	\]
	Первое слагаемое сходится к чему-то по условию, а ко второму мы применяем лемму Теплица (то есть оно тоже сходится), что и требовалось доказать.
\end{proof}

\begin{theorem} (Усиленный Закон Больших Чисел в форме Колмогорова)
	Пусть $\{\xi_n\}_{n = 1}^\infty$ --- последовательность случайных величин, на которую наложены такие требования:
	\begin{enumerate}
		\item $\xi_n$ независимы и одинаково распределены
		
		\item $\exists \E\xi_1 < \infty$
	\end{enumerate}
	Тогда, если обозначить $S_n = \xi_1 \plusdots \xi_n$, верен Закон Больших Чисел в следующей форме:
	\[
		\frac{S_n}{n} \xrightarrow[n \to \infty]{P \text{ п.н.}} \E\xi_1
	\]
\end{theorem}

\begin{proof}
	Не умаляя общности скажем, что $\E\xi_1 = 0$ (иначе, как и в ранее доказанном УЗБЧ в форме Кантелли, введём $\xi'_i = \xi_i - \E\xi_i$). В силу того, что $\E\xi_1 < \infty$, то сходится ряд $\sum_{n = 1}^\infty P(|\xi_1| \ge n)$. В силу одинаковой распределённости случайных величин, этот ряд абсолютно в точности равен $\sum_{n = 1}^\infty P(|\xi_n| \ge n)$. По лемме Бореля-Кантелли это утверждает, что $P(A) := P(\{\xi_n \ge n\} \text{ б.ч.}) = 0$, то есть с вероятностью 1 случайная величина $\xi_n$ совпадает с $\ol{\xi}_n := \xi_n \cdot \chi\{|\xi_n| < n\}$, начиная с некоторого $n_0$. Стало быть:
	\[
		\forall \omega \notin A\ \ \frac{S_n(\omega)}{n} \xrightarrow[n \to \infty]{} 0 \Lra \frac{\ol{S}_n(\omega)}{n} \xrightarrow[n \to \infty]{} 0
	\]
	Значит, достаточно доказать лишь эквивалентное условие. Проблема возникает в том, что $\ol{\xi}_n$ уже не обязательно имеет математическое ожидание ноль, но на самом деле всё не так плохо, матожидания будут сходится к нулю:
	\[
		\E \ol{\xi}_n = \E(\xi \cdot \chi\{|\xi_n| < n\}) = \E(\xi_1 \cdot \chi\{|\xi_1| < n\})
	\]
	Последний переход верен в силу одинаковой распределенности. Несложно понять, что случайная величина под последним знаком матожидания будет сходится к $\xi_1$ почти наверное (ибо теперь в индикаторе мы просто расширяем диапазон рассматриваемых значений). При этом эта же случайная величина мажорируется $\xi_1$, для которой $\E\xi_1 = 0$. Стало быть, по теореме Лебега
	\[
		\E \ol{\xi}_n = \E(\xi_1 \cdot \chi\{|\xi_1| < n\}) \xrightarrow[n \to \infty]{} \E\xi_1 = 0
	\]
	Теперь, применим теорему Теплица с расходящимся рядом единиц:
	\[
		\frac{\E\ol{\xi}_1 \plusdots \E\ol{\xi}_n}{n} \xrightarrow[n \to \infty]{} 0
	\]
	С учётом этого предела верна эквивалентность:
	\[
		\frac{\ol{S}_n}{n} \xrightarrow[n \to \infty]{} 0 \Lra \frac{\ol{\xi}_1 - \E\ol{\xi}_1 \plusdots \ol{\xi}_n - \E\ol{\xi}_n}{n} \xrightarrow[n \to \infty]{} 0
	\]
	Чтобы показать сходимость последнего, мы покажем почти наверное сходимость ряда $\sum_{n = 1}^\infty (\ol{\xi}_n - \E\ol{\xi}_n) / n$ (если это верно, то по лемме Кронекера с $b_j = j$ получим требуемое). Здесь уже воспользуемся теоремой Колмогорова-Хинчина, нужно проверить ряд дисперсий:
	\begin{multline*}
		\sum_{n = 1}^\infty D\frac{\ol{\xi}_n - \E\ol{\xi}_n}{n} = \sum_{n = 1}^\infty \frac{D(\ol{\xi}_n - \E\ol{\xi}_n)}{n^2} \le \sum_{n = 1}^\infty \frac{\E(\ol{\xi}_n - \E\ol{\xi}_n)^2}{n^2} = \sum_{n = 1}^\infty \frac{D\ol{\xi}_n}{n^2} \le \sum_{n = 1}^\infty \frac{\E\ol{\xi}_n^2}{n^2} =
		\\
		\sum_{n = 1}^\infty \frac{\E(\xi_n^2 \cdot \chi\{|\xi_n| < n\})}{n^2} = \sum_{n = 1}^\infty \frac{\E(\xi_1^2 \cdot \chi\{|\xi_1| < n\})}{n^2} =
		\\
		\sum_{n = 1}^\infty \frac{1}{n^2} \sum_{k = 1}^n \E(\xi_1^2 \cdot \chi\{k - 1 \le |\xi_1| < k\}) = \sum_{k = 1}^\infty \E(\xi_1^2 \cdot \chi\{k - 1 \le |\xi_1| < k\}) \underbrace{\sum_{n = k}^\infty \frac{1}{n^2}}_{\le 2 / k} \le
		\\
		2\sum_{k = 1}^\infty \E\ps{\frac{\xi_1^2}{k} \cdot \chi\{k - 1 \le |\xi_1| < k\}} \le 2 \sum_{k = 1}^\infty \E(|\xi_1| \cdot \chi\{k - 1 \le |\xi_1| < k\}) = 2\E |\xi_1| < \infty
	\end{multline*}
\end{proof}

\begin{anote}
	План доказательства УЗБЧ в форме Колмогорова:
	\begin{enumerate}
		\item Не умаляя общности требуем $\E\xi_1 = 0$, из-за сходимости сходится ряд
		
		\item По лемме Бореля-Кантелли для ряда получаем, что вероятность $P(\{\xi_n \ge n\} \text{ б.ч.}) = 0$, то есть начиная с некоторого номера $\xi_n$ совпадает с $\ol{\xi}_n := \xi_n \cdot \chi\{|\xi_n| < n\}$
		
		\item В силу совпадения случайных величин на множестве меры 1, нам всего лишь надо проверить теорему на $\ol{\xi}_n$
		
		\item Доказать, что среднее от матожиданий новых величин стремится к нулю (лемма Теплица). Перейти от эквивалентности сходимости с $\ol{\xi}_n$ на сходимость с $\ol{\xi}_n - \E\ol{\xi}_n$
		
		\item Доказать сходимость среднего $\ol{\xi}_n - \E\ol{\xi}_n$. Для этого нужно внаале перейти к проверке ряда через лемму Кронекера, а затем проверить его на выполнение теоремы Колмогорова-Хинчина (дисперсия оценивается квадратом матожидания, индикатор $|\xi_1| < n$ разбивается на кусочки длины 1)
	\end{enumerate}
\end{anote}