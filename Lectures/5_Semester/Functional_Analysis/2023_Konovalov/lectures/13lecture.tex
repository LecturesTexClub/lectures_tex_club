\begin{proof}
	Будем считать, что $E$ --- вещественное и сепарабельное пространство. Также исключим из рассмотрения случай, когда $\cl M = E$ как тривиальный (тогда просто используем теорему о продолжении линейного ограниченного оператора)
	\begin{enumerate}
		\item (Присоединение ещё одного измерения) Коль скоро $\cl M \subset E$, мы можем найти вектор $x_0 \notin \cl M$. Покажем, как строить последовательность расширений $M_k$ и соответственно функционалов $f_k$ на них, где $M_0 = M$ и $M_k \supset M_{k - 1}$. На примере получения $M_1$ сделаем это так:
		\[
			M_1 = M_0 \oplus [x_0]
		\]
		Если существует оператор $f_1$, который является продолжением $f$ на $M_1$, то он должен лежать в $M_1^*$ и, следовательно, быть линейным. За счёт этого его вид можно однозначно получить по линейности, именно так мы и зададим его значения по определению:
		\[
			\forall y \in M_1\ \exists! z \in M_0, \alpha \in \R \such y = z + \alpha x_0 \ra f_1(y) = f_1(z) + \alpha f_1(x_0)
		\]
		Теперь идея состоит в том, чтобы определить $a = f_1(x_0)$ таким образом, чтобы $f_1$ согласовался с $f$: $\|f_1\| = \|f\|$. Заметим сначала, что всегда $\|f_1\| \ge \|f\|$. Неравенство в другую сторону будет выполнено тогда и только тогда, когда выполнено такое утверждение:
		\[
			\forall y \in M_1\ \ \|f_1(y)\| \le \|f\| \cdot \|y\|
		\]
		Будем искать $a$, используя неравенство как ориентир, верное предположение:
		\[
			\|f_1(z + \alpha x_0)\| \le \|f\| \cdot \|z + \alpha x_0\| \Lra \no{f_1\ps{\frac{z}{\alpha} + x_0}} \le \|f\| \cdot \no{\frac{z}{\alpha} + x_0}
		\]
		Для удобства обозначим $w = z / \alpha$. В самом начале мы пожелали жить в вещественном пространстве, поэтому можем расписать неравенство как модуль:
		\[
			-\|f\| \cdot \|w + x_0\| \le f_1(w) + f_1(x_0) \le \|f\| \cdot \|w + x_0\|
		\]
		Итак, мы пришли к тому, что $a$ должно удовлетворять такому требованию:
		\[
			\forall w \in M_0\ \ -f(w) - \|f\| \cdot \|w + x_0\| \le a \le -f(w) + \|f\| \cdot \|w + x_0\|
		\]
		Можно заметить, что это требование эквивалентно такому, где левая и правая часть определяются разными $w$:
		\[
			\forall w_1, w_2 \in M_0\ \ -f(w_1) - \|f\| \cdot \|w_1 + x_0\| \le a \le -f(w_2) + \|f\| \cdot \|w_2 + x_0\|
		\]
		Более того, если мы просто покажем, что выполнено неравенство между левой и правой частями, то уж хоть одно $a$ мы найдём, поэтому займёмся именно этим вопросом. Тогда, нам надо получить следующее неравенство:
		\[
			\forall w_1, w_2 \in M_0\ \ f(w_2) - f(w_1) \le \|f\|(\|w_2 + x_0\| + \|w_1 + x_0\|)
		\]
		А это, неожиданно, является верным утверждением в силу линейности и ограниченности $f$:
		\begin{multline*}
			\forall w_1, w_2 \in M_0\ \ |f(w_2) - f(w_1)| = |f(w_2 - w_1)| \le \|f\| \cdot \|w_2 - w_1\| =
			\\
			\|f\| \cdot \|w_2 - w_1 - x_0 + x_0\| \le \|f\|(\|w_2 + x_0\| + \|w_1 + x_0\|)
		\end{multline*}
		
		\item (Расширение до $E$) Мы потребовали, что $E$ сепарабельно. Стало быть, существует счётное всюду плотное множество $X = \{x_n\}_{n = 0}^\infty$. Теперь мы будем итеративно брать не просто произвольные точки из $E \bs \cl M_k$, а будем добирать из $X$. Отсюда возникает последовательность расширений и, следовательно, можно рассмотреть предел этих расширений:
		\[
			M_\infty = \bigcup_{n = 0}^\infty M_n \Ra \cl M_\infty \supseteq \cl X = E
		\]
		Определим $f_\infty$ поточечно:
		\[
			\forall x \in E\ \Big(x \in M_n \ra f_\infty(x) = f_n(x)\Big)
		\]
		Сразу из определения нельзя сказать, что $f_\infty$ является искомым расширением. У нас возникает 2 случая:
		\begin{itemize}
			\item $M_\infty = E$. Тогда $f_\infty$ действительно искомый оператор в силу определения.
			
			\item $M_\infty \neq E$. В силу того, что $\cl M_\infty = E$, мы можем получить искомый оператор $\wdh{f}$ по теореме о продолжении линейного ограниченного оператора. Тогда $\|f\| = \|f_\infty\| = \|\wdh{f}\|$, причём последний совпадает с $f_\infty$ на $M_\infty$, а следовательно и с $f$ на $M$, что мы и хотели.
		\end{itemize}
	\end{enumerate}
\end{proof}

\begin{note}
	Возможны обобщения теоремы Хана-Банаха (если смотреть с точки зрения того, какое доказательство мы привели. Иначе из-за формулировки теоремы первые 2 пункта не актуальны):
	\begin{enumerate}
		\item Отказ от сепарабельности $E$
		
		\item Рассмотрение комплексного случая
		
		\item Отказ от рассмотрения равенства норм. Вместо этого рассмотрим \\ однородно-выпуклый функционал $p \colon E \to \K$ (то есть он является выпуклой вниз функцией, а также имеется однородность по аргументу). Если $f$ --- просто линейный функционал на $M$, причём везде на $M$ верно неравенство $f(x) \le p(x)$, то можно продолжить $f$ на всё пространство $E$ так, что есть согласованность по значениям, а также $\wdh{f}(x) \le p(x)$ на всём $E$.
	\end{enumerate}
	Доказательства первого и последнего варианта можно найти в книге А. Н. Колмогоров, С. В. Фомин <<Элементы теории функций и функционального анализа>>. Второй факт --- в книге Л.В. Канторович, Г.П. Акилов <<Функциональный анализ и прикладная математика>>
\end{note}

\begin{corollary}
	Пусть $M \subset E$ --- линейное многообразие, причём $\cl M \neq E$ и дополнительно $x_0 \notin \cl M$. Тогда существует функционал $f \in E^*$, обладающий следующими свойствами:
	\begin{enumerate}
		\item $M \subseteq \ker f$
		
		\item $f(x_0) = 1$
		
		\item $\|f\| = \frac{1}{\rho(x_0, M)}$
	\end{enumerate}
\end{corollary}

\begin{corollary}
	Пусть $x \in E \bs \{0\}$. Тогда существует функционал $f \in E^*$, обладающий следующими свойствами:
	\begin{enumerate}
		\item $f(x) = \|x\|$
		
		\item $\|f\| = 1$
	\end{enumerate}
\end{corollary}

\begin{corollary}
	Если точки $x, y \in E$ таковы, что выполнено утверждение
	\[
		\forall f \in E^*\ \ f(x) = f(y)
	\]
	Тогда $x = y$
\end{corollary}

\begin{corollary}
	Для нормы любого элемента $x \in E$ верна формула:
	\[
		\forall x \in E\ \|x\| = \sup_{\|f\|_{E^*} =  1} |f(x)|
	\]
\end{corollary}

\begin{example}
	Приведём пару примеров использования следствия теоремы Хана-Банаха:
	\begin{enumerate}
		\item[2.] При помощи этого следствия можно, например, провести \textit{опорную гиперплоскость}. Рассмотрим вещественное пространство $E$, сферу $S := S(0, 1)$ и точку $x_0 \in S$. Гиперплоскость должна задаваться уравнением $f(x) = \alpha$, где $f \in E^*$ как минимум. И нам нужна такая гиперплоскость, что $f(x_0) = \alpha$, а сфера лежит по одну сторону от этой гиперплоскости, то есть (не умаляя общности, можем выбрать знак неравенства):
		\[
			\forall x \in S\ \ f(x) \le \alpha = f(x_0)
		\]
		Итак, соответствующее следствие говорит, что есть функционал $f \in E^*$ такой, что $f(x_0) = \|x_0\| = 1$, причём $\|f\| = 1$. Распишем тогда оценку на норму $\|f(x)\|$:
		\[
			\forall x \in S\ \ |f(x)| = \|f(x)\| \le \|f\| \cdot \|x\| = 1 = f(x_0)
		\]
		Требуемая плоскость найдена.
		
		\item[3.] В будущем мы будем изучать понятие \textit{слабой сходимости}, которое в одном виде уже встречалось в теории вероятностей. В случае функционального анализа, $x_n \xrightarrow{d} x$, если выполнено условие:
		\[
			\forall f \in E^*\ \ \lim_{n \to \infty} f(x_n) = f(x)
		\]
		Возникает вопрос: а почему будет предел единственен? Именно это гарантирует нам соответствующее следствие.
	\end{enumerate}
\end{example}