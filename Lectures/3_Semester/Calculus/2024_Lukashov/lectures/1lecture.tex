\section{Экстремумы функций многих переменных}

\begin{definition}
	Точка $\vv{x}_0 \in \R^n$ называется \textit{точкой локального максимума} функции $f \colon \R^n \to \R$, если выполнено условие:
	\[
		\exists \delta > 0 \such \forall \vv{x} \in U_\delta(\vv{x}_0)\ f(\vv{x}) \le f(\vv{x}_0)
	\]
\end{definition}

\begin{definition}
	Точка $\vv{x}_0 \in \R^n$ называется \textit{точкой локального минимума} функции $f \colon \R^n \to \R$, если выполнено условие:
	\[
	\exists \delta > 0 \such \forall \vv{x} \in U_\delta(\vv{x}_0)\ f(\vv{x}) \ge f(\vv{x}_0)
	\]
\end{definition}

\begin{note}
	Если неравенства в определениях выше являются \textit{строгими в некоторой проколотой окрестности}, то $\vv{x}_0$ называется \textit{точкой строгого локального максимума (минимума)}.
\end{note}

\begin{theorem} (Необходимое условие локального экстремума)
	Если $\vv{x}_0$ - точка локального экстремума функции $f \colon \R^n \to \R$, дифференцируемой в некоторой окрестности точки $\vv{x}_0$, то выполнено равенство:
	\[
		df(\vv{x}_0) = 0
	\]
	или, иначе говоря, все частные производные в точке $\vv{x}_0$ равны нулю.
\end{theorem}

\begin{proof}
	Зафиксируем $k \in \{1, \ldots, n\}$. Рассмотрим следующую функцию одной переменной:
	\[
		\psi_k(x) = f(x_{1, 0}, \ldots, x_{(k - 1), 0}, x, \ldots, x_{n, 0})
	\]
	где, естественно, $\vv{x}_0 = (x_{1, 0}, \ldots, x_{n, 0})$. Коль скоро $f$ дифференцируема, то и $\psi_k$ --- тоже. В таком случае, мы можем сослаться на теорему Ферма для локального экстремума функции одной переменной и получить, что
	\[
		\frac{\psi_k}{dx}(x_0) = 0 = \pd{f}{x_k}(\vv{x}_0)
	\]
\end{proof}

\begin{definition}
	Если $f \colon \R^n \to \R$ дифференцируема в окрестности точки $\vv{x}_0$ и $df(\vv{x}_0) = 0$, то $\vv{x}_0$ называется \textit{стационарной точкой} функции $f$.
\end{definition}

\begin{example}
	Мы доказали лишь необходимость локального экстремума быть при этом стационарной точкой. В обратную стоону это неверно, например для функции $f(x, y) = x^4 - y^4$. Действительно:
	\begin{enumerate}
		\item $(0, 0)$ - стационарная точка
		
		\item $f(x, 0) = x^4$, поэтому $(0, 0)$ - точка локального минимума по $x$
		
		\item $f(0, y) = -y^4$, поэтому $(0, 0)$ - точка локального максимума по $y$
	\end{enumerate}
\end{example}

\begin{note}
	Откуда брать достаточное условие на экстремум? У нас нету вторых производных, но есть второй дифференциал. Посмотрим внимательно на него у какой-то дифференцируемой функции $f$ в точке $\vv{x}_0$:
	\[
		d^2f(\vv{x}_0) = \ps{\pd{f}{x_1}(\vv{x}_0)dx_1 + \ldots + \pd{f}{x_n}(\vv{x}_0)dx_n}^2 f(\vv{x}_0) = \sum_{i = 1}^n \sum_{j = 1}^n \pd{^2 f}{x_i \vdelta x_j}(\vv{x}_0) dx_i dx_j
	\]
	Это есть ничто иное как \textit{квадратичная форма от вектора приращения}. Из её свойств мы уже можем получить достаточное условие.
\end{note}

\begin{theorem} (Достаточное условие локального экстремума)
	Если $\vv{x}_0$ - стационарная точка функции $f$, которая дважды дифференцируема в ней, то
	\begin{enumerate}
		\item Если $d^2f(\vv{x}_0)$ --- положительно определенная квадратичная форма, то $\vv{x}_0$ является точкой строгого локального минимума функции $f$
		
		\item Если $d^2f(\vv{x}_0)$ --- отрицательно определенная квадратичная форма, то $\vv{x}_0$ является точкой строгого локального максимума функции $f$
		
		\item Если $d^2f(\vv{x}_0)$ --- неопределенная квадратичная форма, то $\vv{x}_0$ не является точкой локального экстремума
	\end{enumerate}
\end{theorem}

\begin{proof}~
	\begin{enumerate}
		\item В силу условия, мы можем представить функцию $f$ в некоторой окрестности точки $\vv{x}_0$ по формуле Тейлора с остатком в форме Пеано:
		\[
			f(\vv{x}) = f(\vv{x}_0) + df(\vv{x}_0) + \frac{1}{2}d^2f(\vv{x}_0) + o(\rho^2),\ \rho \to 0
		\]
		при этом полагаем $dx_k = x_k - x_{k, 0}$ и $\rho = \sqrt{\sum_{k = 1}^n (x_k - x_{k, 0})^2}$. Более того, $df(\vv{x}_0) = 0$ за счёт условия. Тогда
		\[
			f(\vv{x}) - f(\vv{x}_0) = \frac{1}{2} d^2f(\vv{x}_0) + o(\rho^2),\ \rho \to 0
		\]
		сделаем замену $\xi_i = (x_i - x_{i, 0}) / \rho$, распишем второй дифференциал по удобной формуле и вынесем $\rho^2$ за скобки:
		\[
			f(\vv{x}) - f(\vv{x}_0) = \frac{1}{2}\rho^2 \Bigg(\underbrace{\sum_{i = 1}^n \sum_{j = 1}^n \pd{^2 f}{x_i \vdelta x_j} (\vv{x}_0) \xi_i \xi_j}_{F(\xi_1, \ldots, \xi_n)} + o(1)\Bigg),\ \rho \to 0
		\]
		Введённая $F$ является непрерывной (в окрестности) квадратичной формой от $\vv{\xi}$, причём положительно определенной. Более того, из определения $\xi_i$ следует интересный факт:
		\[
			\xi_1^2 + \ldots + \xi_n^2 = 1
		\]
		То есть мы <<бегаем>> по $n$-мерной сфере. Очевидным образом это ограниченное и замкнутое множество, а значит верна теорема Вейерштрасса: $F$ где-то достигает своего минимума:
		\[
			\min_{\xi_1^2 + \ldots + \xi_n^2 = 1} F(\xi_1, \ldots, \xi_n) = C > 0
		\]
		Тогда, для достаточно малом $\rho > 0$, мы можем потребовать всю скобку быть больше какого-нибудь $C / 2$, а тогда
		\[
			f(\vv{x}) - f(\vv{x}_0) \ge \frac{C}{4} \rho^2 > 0
		\]
		
		\item Аналогично первому утверждению
		
		\item Коль скоро второй дифференциал не является определенной формой, то
		\[
			\exists \vv{\xi}_1, \vv{\xi}_2 \such F(\vv{\xi}_1) > 0 \wedge F(\vv{\xi}_2) < 0
		\]
		Как быть с величиной $o(1)$ в скобках? Просто заметим, что $\xi_i$ не меняется, если взять точку поближе на отрезке от $x_0$ до $x$, т.е. разделить числитель и знаменатель на одинаковую константу. Выберем её достаточно маленькой, чтобы $o(1), \rho \to 0$ при этом было по модулю меньше значения формы. Получим таким образом, что $f$ принимает значения разного знака в произвольно малой окрестности.
	\end{enumerate}
\end{proof}

\begin{corollary} (Достаточное условие локального экстремума функции двух переменных)
	Если $(x_0, y_0)$ --- стационарная точка функции $f(x, y)$, дважды дифференцируемой в этой точке, то
	\begin{enumerate}
		\item Если $\pd{^2 f}{x^2} \cdot \pd{^2 f}{y^2} - \ps{\pd{f}{x \vdelta y}} > 0$ в точке $(x_0, y_0)$, то $(x_0, y_0)$ является строгой точкой экстремума для $f$
		
		\item Если $\pd{^2 f}{x^2} \cdot \pd{^2 f}{y^2} - \ps{\pd{f}{x \vdelta y}} < 0$ в точке $(x_0, y_0)$, то $(x_0, y_0)$ не является экстремумом для $f$.
	\end{enumerate}
\end{corollary}

\begin{proof}
	Достаточно сослаться на критерий Сильвестра для определенности квадратичной формы.
\end{proof}

\begin{definition}
	Пусть $f, \phi_1, \ldots, \phi_m$ заданы в открытом множестве $G \subset \R^n$, $m < n$. Обозначим $E = \{\vv{x} \in G \colon \forall j \in \range{m}\ \ \phi_j(\vv{x}) = 0\}$. Тогда $\vv{x}_0 \in E$ называется \textit{точкой условного минимума функции $f$ при наличии связей $\forall j \in \range{m}\ \phi_j(\vv{x}) = 0$}, если
	\[
		\exists \delta > 0 \such \forall \vv{x} \in U_\delta(\vv{x}_0) \cap E\ \ f(\vv{x}) \ge f(\vv{x}_0)
	\]
\end{definition}

\begin{definition}
	Пусть $f, \phi_1, \ldots, \phi_m$ заданы в открытом множестве $G \subset \R^n$, $m < n$. Обозначим $E = \{\vv{x} \in G \colon \forall j \in \range{m}\ \ \phi_j(\vv{x}) = 0\}$. Тогда $\vv{x}_0 \in E$ называется \textit{точкой условного максимума функции $f$ при наличии связей $\forall j \in \range{m}\ \phi_j(\vv{x}) = 0$}, если
	\[
	\exists \delta > 0 \such \forall \vv{x} \in U_\delta(\vv{x}_0) \cap E\ \ f(\vv{x}) \le f(\vv{x}_0)
	\]
\end{definition}

\begin{note}
	Рассмотрим такую абстрактную ситуацию, когда $f, \phi_1, \ldots, \phi_m$ непрерывно дифференцируемы в точке $\vv{x}_0 \in E$, причём
	\[
		\text{rk} A = \text{rk} \Matrix{
			&{\pd{\phi_1}{x_1}}& &\cdots &{\pd{\phi_1}{x_n}}
			\\
			&\vdots& &\ddots &\vdots
			\\
			&{\pd{\phi_m}{x_1}}& &\cdots &{\pd{\phi_m}{x_n}}
		} = m \text{ (частные производные берутся в $\vv{x}_0$)}
	\]
	Без ограничения общности, потребуем главный минор порядка $m$ быть ненулевым. Тогда по теореме о неявной функции, заданной системой уравнений, в некоторой окрестности точки $(x_{(m + 1), 0}, \ldots, x_{n, 0})$ будут единственным образом определены функции $\forall j \in \range{m}\ \ x_j = \psi_j(x_{m + 1}, \ldots, x_n)$ так, что в этой окрестности точки $\vv{x}_0$ верна равносильность:
	\[
		\Big(\forall j \in \range{m}\ \ \phi_j(\vv{x}) = 0\Big) \lra \Big(\forall j \in \range{m}\ \ x_j = \psi_j(x_{m + 1}, \ldots, x_n)\Big)
	\]
	В таком случае, задача на условный экстремум функции $f$ при вышеуказанных связях эквивалентно задаче на локальный (безусловный) экстремум функции $F(x_{m + 1}, \ldots, x_n)$, заданной следующим образом:
	\[
		F(x_{m + 1}, \ldots, x_n) = f(\psi_1(x_{m + 1}, \ldots, x_n), \ldots, \psi_m(x_{m + 1}, \ldots, x_n), x_{m + 1}, \ldots, x_n)
	\]
	Это даёт способ решения задач на условный экстремум.
\end{note}

\begin{definition}
	\textit{Функцией Лагранжа для задачи на условный экстремум функции $f$ при наличии связей $\forall j \in \range{m}\ \phi_j(\vv{x}) = 0$} называется
	\[
		L(x_1, \ldots, x_n, \lambda_1, \ldots, \lambda_m) = f(x_1, \ldots, x_n) + \sum_{k = 1}^m \lambda_k \phi_k(x_1, \ldots, x_m)
	\]
	где $\lambda_1, \ldots, \lambda_m$ - \textit{множители Лагранжа}.
\end{definition}

\begin{theorem} (Необходимое условие локального экстремума)
	Пусть $f, \phi_1, \ldots, \phi_m,\ m < n$ --- дифференцируемые функции в окрестности точки $\vv{x}_0$, при этом верны условия:
	\begin{enumerate}
		\item $\forall j \in \range{m}\ \ \phi_j(\vv{x}_0) = 0$
		
		\item $\text{rk} A = m$ в точке $\vv{x}_0$, где $A$ --- матрица из замечания
		
		\item $\vv{x}_0$ --- точка условного экстремума $f$ при наличии связей $\forall j \in \range{m}\ \phi_j(\vv{x}) = 0$
	\end{enumerate}
	Тогда, существует единственный набор множителей Лагранжа $\lambda_{1, 0}, \ldots, \lambda_{m, 0}$ таких, что $(x_{1, 0}, \ldots, x_{n, 0}, \lambda_{1, 0}, \ldots, \lambda_{m, 0})$ --- стационарная точка функции Лагранжа.
\end{theorem}

\begin{proof}
	Если $\vv{x}_0$ --- условный экстремум, то мы уже знаем, что $(x_{(m + 1), 0}, \ldots, x_{n, 0})$ -- точка локального экстремума функции $F(x_{m + 1}, \ldots, x_n)$. Тогда, по необходимому условию (в силу дифференцируемости $F$)
	\[
		dF(x_{(m + 1), 0}, \ldots, x_{n, 0}) = 0
	\]
	Это эквивалентно следующему (при положении $\forall j \in \range{m}\ dx_j = d\psi_j(x_{(m + 1), 0}, \ldots, x_{n, 0})$):
	\[
		\sum_{j = 1}^n \pd{f}{x_j} (\vv{x}_0) dx_j = 0
	\]
	При этом верна и другая эквивалентность:
	\[
		\forall j \in \range{m}\ dx_j = d\psi_j(x_{(m + 1), 0}, \ldots, x_{n, 0}) \Longleftrightarrow \forall j \in \range{m}\ d\phi_j(\vv{x}_0) = 0
	\]
	Теперь, домножим $d\phi_j$ на пока произвольные $\lambda_k$, сложим эти равенства вместе и добавим к ним ещё эквивалентное равенство на дифференциал $F$. Тогда
	\[
		\sum_{j = 1}^n \ps{\pd{f}{x_j}(\vv{x}_0) + \sum_{k = 1}^m \lambda_k \pd{\phi_k}{x_j}(\vv{x}_0)}dx_j = 0 = \sum_{j = 1}^n \pd{L}{x_j}(\vv{x}_0)dx_j
	\]
	Казалось бы, получили равенство на дифференциал функции Лагранжа. Однако, первые $m$ переменных тут не являются независимыми, они представлены в виде значений функций $\psi_j$. Что было бы, если бы мы потребовали производные по этим независимым переменным быть равными нулю? Тогда, мы бы получили $m$ уравнений, которые в матричном виде будут выдадут ничто иное как невырожденную матрицу $A$. Следовательно, существует единственный набор констант $\lambda_1, \ldots, \lambda_m$ такой, что каждое выражение под большой скобкой для $j \in \range{m}$ окажется равным нулю. Отсюда
	\[
		\sum_{j = m + 1}^n \pd{L}{x_j} (\vv{x}_0) dx_j = 0 \Longleftrightarrow \forall j \in \{m + 1, \ldots, n\}\ \ \pd{L}{x_j}(\vv{x}_0) = 0
	\]
	Остаётся посмотреть на частную производную $L$ по $\lambda_k$:
	\[
		\pd{L}{\lambda_k}(\vv{x}_0, \vv{\lambda}_0) = \phi_k(\vv{x}_0, \vv{\lambda}_0) = 0
	\]
\end{proof}

\begin{theorem} (Достаточное условие условного экстремума)
    Пусть функции $f_1, \phi_1, \dots, \phi_m$, $m < n$, дважды непрерывно дифференцируемы в окрестности точки $\vv{x}_0$, причём верны условия:
    \begin{enumerate}
    	\item Ранг следующей матрицы максимален:
    	\[
    		\rk \begin{pmatrix}
	    		\frac{\vdelta \phi_1}{\vdelta x_1}(\vv{x}_0) & \dots & \frac{\vdelta \phi_1}{\vdelta x_n}(\vv{x}_0)
	    		\\
	    		\vdots & \ddots & \vdots
	    		\\
	    		\frac{\vdelta \phi_m}{\vdelta x_1}(\vv{x}_0) & \dots & \frac{\vdelta \phi_m}{\vdelta x_n}(\vv{x}_0)
	    		\\
    		\end{pmatrix} = m
    	\]
    	
    	\item Точка $(\vv{x}_0, \vv{\lambda}_0)$ является стационарной точкой функции Лагранжа $L(\vv{x}, \vv{\lambda})$
    	
    	\item $d^2_{xx}L(\vv{x}_0, \vv{\lambda}_0)$ является положительно (отрицательно) определенной квадратичной формой переменных $dx_1, \ldots, dx_n$, продифференцированным уравнением связи $\forall j \in \range{m}\ d\phi_j(\vv{x}_0)$
    	
    	\item Имеются связи $\forall j \in \range{m}\ \phi_j(\vv{x}_0) = 0$
    \end{enumerate}
	Тогда $\vv{x}_0$ является точкой строгого условного минимума (максимума) функции $f$. Если же $d^2_{xx} L(\vv{x}_0, \vv{\lambda}_0)$ является неопределенной квадратичной формой (от тех же переменных), то $\vv{x}_0$ не является точкой условного экстремума той же функции.
\end{theorem}

\begin{proof}
    Без ограничения общности считаем главный минор $\frac{\vdelta (\phi_1, \dots, \phi_m)}{\vdelta (x_1, \dots, x_m)} \neq 0$. Как было отмечено перед теоремой 1 задача на условный экстремум $\Leftrightarrow$ задаче на локальный (безусловный) экстремум функции 
    \[
        F (x_{m+1}, \dots, x_n) = f(\psi(x_{m+1}, \dots, x_n), \dots, \psi_m(x_{m+1}, \dots, x_n), x_{m+1}, \dots, x_n)
    \]
    Достаточное условие локального экстремума $F\colon d^2F(\vec{\tilde{x^{(0)}}})$ - положительно (отрицательно) определенная форма.\\
    \[
        d^2F = d(d F) = d \left ( \begin{aligned} \sum^n_{j=1} \frac{\vdelta f}{\vdelta x_j} d x_j \end{aligned}  \right ) = d \left ( \begin{aligned} \sum^n_{j = 1} \frac{\vdelta L}{\vdelta x_j} d x_j \end{aligned}  \right ) = \sum^n_{j=1} \sum^n_{k=1} \frac{\vdelta^2 L}{\vdelta x_j \vdelta x_k} d x_j d x_k + \sum^m_{j=1} \frac{\vdelta L}{\vdelta x_j} d^2 x_j.
    \]
    Воспользуемся тем, что точки $(\vv{x}^{(0)}, \vec{\lambda^{(0)}})$ - стационарные, значит $\frac{\vdelta L}{\vdelta x_j} = 0$. Мы получили в точности форму второго дифференциала. Причем переменные $x_j, x_k$ не являются независимыми, а являются связанными условиями дифференцирования. \\
    Аналогичное доказательство производится для неопределенной квадратичной формы.
\end{proof}

\begin{example} (Кудрявцев - 3 часть, $\S 5, 33(2)$) \\
    Найти максимум и минимум функции $u = x^2 + 2y^2+3z^2$ при ограничениях $x^2+y^2+z^2=1, x+2y+3z=0.$
\end{example}

\begin{solution}
    Заметим, что речь идет об абсолютном экстремуме (в условии нет слова локальный). 
    В данном случае ограничения на $x, y, z$ задают сферу, которая пересекается с плоскостью, проходящей через начало координат. Значит, мы имеем дело с окружностью. \\
    Решение с помощью функции Лагранжа:
    \[ 
        L(x, y, z, \lambda, \mu) = x^2+2y^2+3z^3+\lambda(x^2+y^2+z^2-1)+\mu(x+2y+3z)
    \]
    Найдем стационарные точки функции Лагранжа$\colon$
    \[
        \frac{\vdelta L}{\vdelta x} = 2x+2\lambda x + \mu =0
    \]
    \[
        \frac{\vdelta L}{\vdelta y} = 4y+2\lambda y + 2\mu=0\\
    \]
    \[
        \frac{\vdelta L}{\vdelta z} = 6z+2\lambda z + 3\mu=0\\
    \] 
    Мы получили систему из 5 уравнений с 5 неизвестными. Для ее решения воспользуемся приемом:
    \[
        (2x+2\lambda x + \mu) \cdot x =0 \cdot x\\
    \]
    \[
        (4y+2\lambda y + 2\mu) \cdot y=0 \cdot y\\
    \]
    \[
        (6z+2\lambda z + 3\mu) \cdot z=0 \cdot z\\
    \] 
    Сложим все уравнения системы:
    \[
        (2x+2\lambda x + \mu) \cdot x + \\
    \]
    \[
        + (4y+2\lambda y + 2\mu) \cdot y + \\
    \]
    \[
        + (6z+2\lambda z + 3\mu) \cdot z=\\
    \]
    \[
        = 2u + 2\lambda + 0\mu = 2u + 2\lambda = 0\\
    \]
    Из этого уравнения можно сделать следующий вывод: максимальное (минимальное) значение $u$ зависит от минимального (максимального) значения $\lambda$. Т.е. нам не нужно решать задачу в полном виде (ведь требуется найти минимум и максимум функции, а не какую-то конкретную точку).\\
    Еще раз сложим все уравнения системы (в этот раз без домножения):
    \[
        (2x+2\lambda x + \mu) + \\
        + (4y+2\lambda y + 2\mu) + \\
        + (6z+2\lambda z + 3\mu)=\\
        = 0 + 2\lambda (x+y+z) +6\mu=0\\
    \]
    \[
        \mu = -\frac{\lambda}{3} (x+y+z)
    \]
     Подставим найденное $\mu$ в исходную систему:
     \[
        x(2+\frac{5}{3}\lambda)-\frac{\lambda}{3}y-\frac{\lambda}{3}z=0\\
    \]
    \[
        -\frac{2}{3}\lambda x + y(4+\frac{4}{3}\lambda)-\frac{2}{3}\lambda z=0\\
    \]
    \[
        -\lambda x - \lambda y + z(6+\lambda)=0\\
     \]
     Мы получили неоднородную систему уравнений. Тривиальное решение $x=0, y=0, z=0$ не является ее решением из-за ограничения в условии: $x^2+y^2+z^2=1$. Поэтому для того, чтобы решение существовало, определитель матрицы этой системы однородных уравнений должен быть равен $0$.
     \[
        \begin{vmatrix}
            2+\frac{5}{3}\lambda & -\frac{\lambda}{3} & -\frac{\lambda}{3}\\
            -\frac{2}{3}\lambda & 4+\frac{4}{3}\lambda & -\frac{2}{3}\lambda\\
            -\lambda & -\lambda & 6+\lambda
        \end{vmatrix} = 0\\
    \]
    \[
        det (A - \lambda B)=0 \\
     \]
     Посчитаем определитель, раскроем скобки и приведем подобные слагаемые:
     \[
        \frac{56}{3}\lambda^2 + 64\lambda+48=0\\
    \]
    \[
        \frac{7}{3}\lambda^2+8\lambda+6=0\\
    \]
    \[
        \lambda_1 = \frac{-12+3\sqrt{2}}{7}\\
    \]
    \[
        \lambda_2 = \frac{-12-3\sqrt{2}}{7}
     \]
    Найденные значения $\lambda$ согласно вышеприведенным рассуждениям соответсвуют минимуму и максимуму исходной функции.
\end{solution}